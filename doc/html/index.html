<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="Jean-Louis Leroy">
<title>OpenMethod: an emulation of N2216</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OpenMethod: an emulation of N2216</h1>
<div class="details">
<span id="author" class="author">Jean-Louis Leroy</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#tutorial">Tutorial</a>
<ul class="sectlevel2">
<li><a href="#hello_world">Hello World</a></li>
<li><a href="#next">Next</a></li>
<li><a href="#multiple_dispatch">Multiple Dispatch</a></li>
<li><a href="#multiple_inheritance">Multiple Inheritance</a></li>
<li><a href="#friendship">Friendship</a></li>
<li><a href="#performance">Performance</a></li>
<li><a href="#virtual_ptr"><code>virtual_ptr</code></a></li>
</ul>
</li>
<li><a href="#advanced_features">Advanced Features</a>
<ul class="sectlevel2">
<li><a href="#core_api">Core API</a></li>
<li><a href="#policies_and_facets">Policies and Facets</a></li>
<li><a href="#error_handling">Error Handling</a></li>
<li><a href="#custom_rtti">Custom RTTI</a></li>
<li><a href="#deferred_rtti">Deferred RTTI</a></li>
</ul>
</li>
<li><a href="#reference">Reference</a>
<ul class="sectlevel2">
<li><a href="#headers">Headers</a></li>
<li><a href="#namespaces">Namespaces</a></li>
<li><a href="#macros">Macros</a>
<ul class="sectlevel3">
<li><a href="#BOOST_OPENMETHOD">BOOST_OPENMETHOD</a></li>
<li><a href="#BOOST_OPENMETHOD_OVERRIDE">BOOST_OPENMETHOD_OVERRIDE</a></li>
<li><a href="#BOOST_OPENMETHOD_INLINE_OVERRIDE">BOOST_OPENMETHOD_INLINE_OVERRIDE</a></li>
<li><a href="#BOOST_OPENMETHOD_REGISTER">BOOST_OPENMETHOD_REGISTER</a></li>
<li><a href="#BOOST_OPENMETHOD_CLASSES">BOOST_OPENMETHOD_CLASSES</a></li>
<li><a href="#BOOST_OPENMETHOD_DEFAULT_POLICY">BOOST_OPENMETHOD_DEFAULT_POLICY</a></li>
<li><a href="#BOOST_OPENMETHOD_NAME">BOOST_OPENMETHOD_NAME</a></li>
<li><a href="#BOOST_OPENMETHOD_OVERRIDERS">BOOST_OPENMETHOD_OVERRIDERS</a></li>
</ul>
</li>
<li><a href="#core_api_2">Core API</a>
<ul class="sectlevel3">
<li><a href="#method">method</a></li>
<li><a href="#virtual">virtual_</a></li>
<li><a href="#virtual_ptr_2">virtual_ptr</a></li>
</ul>
</li>
<li><a href="#policies_facets">Policies &amp; Facets</a>
<ul class="sectlevel3">
<li><a href="#basic_policy">basic_policy</a></li>
<li><a href="#error_output">error_output</a></li>
<li><a href="#basic_error_output">basic_error_output</a></li>
<li><a href="#std_rtti">std_rtti</a></li>
<li><a href="#deferred_static_rtti">deferred_static_rtti</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Open-methods are similar to virtual functions, but they are not required to be
members of a class. By being simultaneously free <em>and</em> virtual, they provide a
solution to the Expression Problem:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Given a set of types, and a set of operations on these types, is it possible
to add new operations on the existing types, and new types to the existing
operations, without modifying existing code?</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>As a bonus, open-methods can take more than one argument into account when
selecting the appropriate function to call. This solves the problem of multiple
dispatch.</p>
</div>
<div class="paragraph">
<p>Open-methods are part of Lisp, Clojure, Julia, Cecil, Dylan, TADS, and other
languages. Bjarne Stroustrup wanted open-methods in C++ almost from the
beginning. He writes about it in D&amp;E. Circa 2007, with his PhD students Peter
Pirkelbauer and Yuriy Solodkyy, they wrote a series of papers and an
implementation based on the EDG compiler. Their design fit perfectly with othe
parts of the language. They proposed it for adoption in the standard. It did not
happen.</p>
</div>
<div class="paragraph">
<p>This library implements the proposal, as closely as possible within the C++17
standard.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial">Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>foo bar</p>
</div>
<div class="sect2">
<h3 id="hello_world">Hello World</h3>
<div class="paragraph">
<p>Here is a side-by-side implementation of the same program, using virtual
functions (on the left side) and open-methods (on the right side):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">virtual function</th>
<th class="tableblock halign-left valign-top">open-method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>


<span class="k">struct</span> <span class="nc">Animal</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">Animal</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="n">Animal</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Dog</span> <span class="o">:</span> <span class="n">Animal</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>




<span class="kt">void</span> <span class="n">Cat</span><span class="o">::</span><span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"hiss"</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">Dog</span><span class="o">::</span><span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"bark"</span><span class="p">;</span>
<span class="p">}</span>




<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>


    <span class="n">Animal</span><span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">();</span>
    <span class="n">Animal</span><span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">();</span>

    <span class="n">a</span><span class="p">.</span><span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">);</span> <span class="c1">// prints "hiss"</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="n">a</span><span class="p">.</span><span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">);</span> <span class="c1">// prints "bark"</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;boost/openmethod.hpp&gt;</span><span class="c1">               </span><span class="cp"><b class="conum">(1)</b>
#include</span> <span class="cpf">&lt;boost/openmethod/compiler.hpp&gt;</span><span class="c1">      </span><span class="cp"><b class="conum">(2)</b>
</span>
<span class="k">struct</span> <span class="nc">Animal</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">Animal</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>              <b class="conum">(3)</b>
<span class="p">};</span>


<span class="k">struct</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="n">Animal</span> <span class="p">{</span>                         <b class="conum">(3)</b>
<span class="p">};</span>


<span class="k">struct</span> <span class="nc">Dog</span> <span class="o">:</span> <span class="n">Animal</span> <span class="p">{</span>                         <b class="conum">(3)</b>
<span class="p">};</span>


<span class="n">BOOST_OPENMETHOD</span><span class="p">(</span>                             <b class="conum">(4)</b>
    <span class="n">poke</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span>                    <b class="conum">(5)</b>
    <span class="n">poke</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Cat</span><span class="o">&amp;</span> <span class="n">cat</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"hiss"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span>                    <b class="conum">(5)</b>
    <span class="n">poke</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"bark"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_CLASSES</span><span class="p">(</span><span class="n">Animal</span><span class="p">,</span> <span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">);</span>   <b class="conum">(6)</b>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="o">::</span><span class="n">initialize</span><span class="p">();</span>          <b class="conum">(7)</b>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="p">);</span>

    <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span> <span class="c1">// prints "hiss"      </span><b class="conum">(8)</b>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">// prints "bark"      </span><b class="conum">(8)</b>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="colist arabic">
<ol>
<li>
<p>Include the main OpenMethod header.</p>
</li>
<li>
<p>Include the compiler header, which provides
<code>boost::openmethod::initialize()</code>. This is typically needed only in the <code>main</code>
translation unit.</p>
</li>
<li>
<p><code>poke</code> does not appear anywhere in the class definitions.</p>
</li>
<li>
<p><code>poke</code> is declared outside of the classes. It is a free function. The
<code>Animal</code> argument, implicitly passed as <code>this</code> to the virtual function, has
become an explicit parameter. Its type is decorated with <code>virtual_</code>. It is not
required to be the first parameter. The virtual function&#8217;s cv-qualifier is now
applied to the virtual parameter. Note that parameter names are not allowed in
<code>BOOST_OPENMETHOD</code> - only types.</p>
</li>
<li>
<p>provides overrides for <code>Cat</code> and <code>Dog</code>.</p>
</li>
<li>
<p>Classes need to be registered for the library to recognize the inheritance
relationships.  This can be done incrementally.</p>
</li>
<li>
<p>builds the dispatch tables.</p>
</li>
<li>
<p><code>poke</code> is called as a free function. The appropriate override is called,
depending on the dynamic type if the virtual argument.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="next">Next</h3>
<div class="paragraph">
<p>If a virtual function overrides a non-pure virtual function, it typically calls
the calls the latter as part of its implementation. The equivalent for
open-methods is a call to special function called <code>next</code>. It calls the next most
specific override, i.e. what would have been called if the current override did
not exist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">Bulldog</span> <span class="o">:</span> <span class="n">Dog</span> <span class="p">{</span>
<span class="p">};</span>

<span class="n">BOOST_OPENMETHOD_CLASSES</span><span class="p">(</span><span class="n">Dog</span><span class="p">,</span> <span class="n">Bulldog</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span>
    <span class="n">poke</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Bulldog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">next</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">dog</span><span class="p">);</span> <span class="c1">// prints "bark"</span>
        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">" and bite"</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multiple_dispatch">Multiple Dispatch</h3>
<div class="paragraph">
<p>Open-methods can have more than one virtual parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD</span><span class="p">(</span>
    <span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="p">);</span>

<span class="c1">// 'encounter' catch-all implementation.</span>
<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Animal</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">Animal</span><span class="o">&amp;</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"ignore"</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Add definitions for specific pairs of animals.</span>
<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog1</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog2</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"wag tail"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">,</span> <span class="n">Cat</span><span class="o">&amp;</span> <span class="n">cat</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"chase"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Cat</span><span class="o">&amp;</span> <span class="n">cat</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"run"</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The appropriate overrider is selected using the same process similar to overload
resolution. If there is no single overrider that is more specialized than all
the others, the return type is used as a tie-breaker, <em>if</em> it is covariant with
the return type of the base method. If there is still no unique overrider, one
of the overriders is chosen arbitrarily.</p>
</div>
</div>
<div class="sect2">
<h3 id="multiple_inheritance">Multiple Inheritance</h3>
<div class="paragraph">
<p>Multiple inheritance is supported, with the exception of repeated inheritance.</p>
</div>
<div class="paragraph">
<p>Virtual inheritance is supported, but it incurs calls to <code>dynamic_cast</code> to cast
the method&#8217;s arguments to the types required by the overrider.</p>
</div>
</div>
<div class="sect2">
<h3 id="friendship">Friendship</h3>

</div>
<div class="sect2">
<h3 id="performance">Performance</h3>
<div class="paragraph">
<p>Open methods are almost as fast as ordinary virtual member functions when
compiled with optimization. For both clang and gcc, dispatching a call to a
method with one virtual argument takes 15-30% more time than calling the
equivalent virtual member function (unless the call goes through a virtual base,
which requires a dynamic cast). If the body of the method does any amount of
work, the difference is unnoticeable.</p>
</div>
<div class="paragraph">
<p>Here is the assembly code generated by clang for the <code>poke</code> method compiled for
the x64 architecture (variable names have been shortened for readability):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="asm">	mov	    rax, qword ptr [rsi]
	mov	    rdx, qword ptr [rip + hash_mult]
	imul	rdx, qword ptr [rax - 8]
	movzx	ecx, byte ptr [rip + hash_shift]
	shr	    rdx, cl
	mov	    rax, qword ptr [rip + vptrs]
	mov	    rax, qword ptr [rax + 8*rdx]
	mov	    rcx, qword ptr [rip + slots_strides]
	mov	    rax, qword ptr [rax + 8*rcx]
	jmp	    rax</code></pre>
</div>
</div>
<div class="paragraph">
<p>The library uses a collision-free hash table to find the dispatch table
(v-table) from the object&#8217;s native type id (). The hash function is very simple
and very fast: <code>H(obj) = (&amp;typeid(obj) * M) &gt;&gt; S</code>. The result is the index of
the open-method v-table in a global array of v-tables.</p>
</div>
<div class="paragraph">
<p>This code performs the following logical steps. When a step contains multiple
instructions, they can be executed in parallel on modern processors. The exact
order in which the steps are executed depends on the processor.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Load the two hash function factors (M and S), a pointer to a hash table,
the v-table pointer from the object, and the offset of the method in the
v-table.</p>
</li>
<li>
<p>Multiply the address of the <code>type_info</code> by M.</p>
</li>
<li>
<p>Shift the result right by S.</p>
</li>
<li>
<p>Load the v-table pointer from the global array of v-tables.</p>
</li>
<li>
<p>Load the function pointer from the v-table.</p>
</li>
<li>
<p>Call (or jump to) the function.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Analyzing the code with tools like uiCA or llvm-mca shows a throughput of 4
cycles per dispatch. Comparatively, calling a native virtual functions takes one
cycle. However, the difference is amortized by the time spent passing the
arguments and returning from the function; plus, of course, executing the body
of the function.</p>
</div>
<div class="paragraph">
<p>Micro benchmarks suggest that the overhead of dispatching an open-methods with a
single virtual argument is between 30% and 50% slower than calling the
equivalent virtual function, if the body is empty.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtual_ptr"><code>virtual_ptr</code></h3>
<div class="paragraph">
<p>The seven first instructions in the assembly code above look up the v-table for
the object. The result will always be the same for the same object. Therefore,
that pointer can be re-used for subsequent calls.</p>
</div>
<div class="paragraph">
<p><code>virtual_ptr</code> is a fat pointer that contains two pointers: one to the object,
and the other to the v-table. Incidentally, this is how Rust and Golang
implement polymorphism.</p>
</div>
<div class="paragraph">
<p><code>virtual_ptr</code>s are used in place of <code>virtual_&lt;&amp;&gt;</code>. They can be passed
through to overriders, which can re-use them to make further method calls. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD</span><span class="p">(</span><span class="n">vocalize</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span>
    <span class="n">vocalize</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Cat</span><span class="o">&gt;</span> <span class="n">cat</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"hiss"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span>
    <span class="n">vocalize</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">dog</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"bark"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD</span><span class="p">(</span>
    <span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span>
    <span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">dog</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Cat</span><span class="o">&gt;</span> <span class="n">cat</span><span class="p">),</span>
    <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vocalize</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">dog</span><span class="p">);</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">" and chase"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span>
    <span class="n">encounter</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Cat</span><span class="o">&gt;</span> <span class="n">cat</span><span class="p">,</span> <span class="n">virtual_ptr</span><span class="o">&lt;</span><span class="n">Dog</span><span class="o">&gt;</span> <span class="n">dog</span><span class="p">),</span>
    <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vocalize</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">cat</span><span class="p">);</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">" and run"</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calls to <code>vocalize</code> compile to three instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="asm">	mov	rax, qword ptr [rip + slots_strides]
	mov	rax, qword ptr [rdx + 8*rax]
	jmp	rax</code></pre>
</div>
</div>
<div class="paragraph">
<p>This executes in one cycle, like native virtual function calls.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
calling <code>initialize</code> invalidates all existing <code>virtual_ptr</code>s.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced_features">Advanced Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="core_api">Core API</h3>
<div class="paragraph">
<p>OpenMethod provides a macro-free interface. This is useful in certain
situations, for example when combining open methods and templates.</p>
</div>
<div class="paragraph">
<p>Here is a rewrite of the Animals example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;boost/openmethod/core.hpp&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">poke_openmethod</span><span class="p">;</span>

<span class="k">using</span> <span class="n">poke</span> <span class="o">=</span> <span class="n">method</span><span class="o">&lt;</span>
    <span class="n">poke_openmethod</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="o">&gt;</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An open-method is implemented as an instance of the <code>method</code> template. It takes
a function signature and a return type.</p>
</div>
<div class="paragraph">
<p>The <code>poke_openmethod</code> class acts as the method&#8217;s identifier: it separates it
from other methods with the same signature. The exact name does not really
matter, and the class needs not be defined, only declared. Inventing a class
name can get tedious, so OpenMethod provides a macro for that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;boost/openmethod/macros/name.hpp&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nf">BOOST_OPENMETHOD_NAME</span><span class="p">(</span><span class="n">pet</span><span class="p">);</span>

<span class="k">using</span> <span class="n">pet</span> <span class="o">=</span> <span class="n">method</span><span class="o">&lt;</span>
    <span class="n">BOOST_OPENMETHOD_NAME</span><span class="p">(</span><span class="n">pet</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="o">&gt;</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
BOOST_OPENMETHOD and associated macros use <code>BOOST_OPENMETHOD_NAME</code> in
their implementation. This makes it possible to mix the "macro" and "core"
styles.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The method can be called via the nested function object <code>fn</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">poke</span><span class="o">::</span><span class="n">fn</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">animal</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Overriders are ordinary functions, added to a method using the nested template
<code>override</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">auto</span> <span class="nf">poke_cat</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Cat</span><span class="o">&amp;</span> <span class="n">cat</span><span class="p">,</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"hiss"</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">poke</span><span class="o">::</span><span class="k">override</span><span class="o">&lt;</span><span class="n">poke_cat</span><span class="o">&gt;</span> <span class="n">override_poke_cat</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>override</code> can register more than one overrider.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In C++26, we can use <code>_</code> instead of inventing an identifier. Otherwise,
OpenMethod provides a small convenience macro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;boost/openmethod/macros/register.hpp&gt;</span><span class="cp">
</span>
<span class="k">auto</span> <span class="nf">poke_dog</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">,</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"bark"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_REGISTER</span><span class="p">(</span><span class="n">poke</span><span class="o">::</span><span class="k">override</span><span class="o">&lt;</span><span class="n">poke_dog</span><span class="o">&gt;</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>next</code> is available from the method&#8217;s nested <code>next</code> template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">auto</span> <span class="nf">poke_bulldog</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Bulldog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">,</span> <span class="kt">void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span> <span class="p">{</span>
    <span class="n">poke</span><span class="o">::</span><span class="n">next</span><span class="o">&lt;</span><span class="n">poke_bulldog</span><span class="o">&gt;</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">dog</span><span class="p">);</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">" and bite"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_REGISTER</span><span class="p">(</span><span class="n">poke</span><span class="o">::</span><span class="k">override</span><span class="o">&lt;</span><span class="n">poke_bulldog</span><span class="o">&gt;</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Since the function uses itself as a template argument in its body, its
return type cannot be deduced. It must be specified explicitly, either by using
the old style or a trailing return type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Why not call <code>poke_dog</code> directly? That may be the right thing to do; however,
keep in mind that, in a real program, a translation unit is not necessarily
aware of the overriders added elsewhere - especially in presence of dynamic
loading.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD_CLASSES</span><span class="p">(</span><span class="n">Animal</span><span class="p">,</span> <span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">,</span> <span class="n">Bulldog</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="o">::</span><span class="n">initialize</span><span class="p">();</span>

    <span class="n">Animal</span><span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">();</span>
    <span class="n">Animal</span><span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">();</span>

    <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span> <span class="c1">// prints "hiss"</span>
    <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">// prints "bark"</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="policies_and_facets">Policies and Facets</h3>
<div class="paragraph">
<p>Methods and classes are scoped in a policy. A method can only reference classes
registered in the same policy. If a class is used as a virtual parameter in
methods using different policies, it must be registered with each of them.</p>
</div>
<div class="paragraph">
<p>Class templates <code>use_classes</code>, <code>method</code>, <code>virtual_ptr</code>, and macros
<code>BOOST_OPENMETHOD</code> and <code>BOOST_OPENMETHOD_CLASSES</code>, accept an additional
argument, a policy class, which defaults to <code>policies::debug</code> in debug builds,
and <code>policies::release</code> in release builds.</p>
</div>
<div class="paragraph">
<p>A policy has a collection of <em>facets</em>. Facets control how type information is
obtained, how vptrs are fetched, how errors are handled and printed, etc. Some
are used in <code>initialize</code> and method dispatch; some are used by other facets in
the same policy as part of their implementation. See the reference for a list of
facets and stock implementations.</p>
</div>
<div class="paragraph">
<p><code>policies::release</code> contains the following facets:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">facet</th>
<th class="tableblock halign-left valign-top">implementation</th>
<th class="tableblock halign-left valign-top">role</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rtti</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">std_rtti</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provide type information for classes and objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vptr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vptr_vector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store vptrs in a global vector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type_hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast_perfect_hash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hash type id to an index in a vector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">error_handler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vectored_error_handler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call a <code>std::function</code> when an error occurs</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>policies::debug</code> contains the same facets as <code>release</code>, plus a few more:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">facet</th>
<th class="tableblock halign-left valign-top">implementation</th>
<th class="tableblock halign-left valign-top">role</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">runtime_checks</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable runtime checks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">error_output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">basic_error_output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">print error descriptions to <code>stderr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trace_output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">basic_trace_output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">make <code>initialize</code> print information about dispatch table construction to  <code>stderr</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Policies, and some facets, have static variables. When it is the case, they are
implemented as CRTP classes.</p>
</div>
<div class="paragraph">
<p>Policies can be created from scratch, using the <code>basic_policy</code> template, or by
adding or removing facets from existing policies. For example, <code>policies::debug</code>
is a tweak of <code>policies::release</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">debug</span> <span class="o">:</span> <span class="n">release</span><span class="o">::</span><span class="n">rebind</span><span class="o">&lt;</span><span class="n">debug</span><span class="o">&gt;::</span><span class="n">add</span><span class="o">&lt;</span>
                   <span class="n">runtime_checks</span><span class="p">,</span> <span class="n">basic_error_output</span><span class="o">&lt;</span><span class="n">debug</span><span class="o">&gt;</span><span class="p">,</span>
                   <span class="n">basic_trace_output</span><span class="o">&lt;</span><span class="n">debug</span><span class="o">&gt;&gt;</span> <span class="p">{};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>rebind</code> creates a new policy from an existing one, substituting the new policy
to the original one in all the CRTP classes. <code>add</code> adds three facets, two of
which have state.</p>
</div>
<div class="paragraph">
<p><code>boost::openmethod::policies::default_</code> is an alias to the <code>release</code> or the
<code>debug</code> policy, depending on the value of preprocessor symbols <code>NDEBUG</code>. The
default policy can be overriden by defining the macroprocessor symbol
<code>BOOST_OPENMETHOD_DEFAULT_POLICY</code> <em>before</em> including
<code>&lt;boost/openmethod/core.hpp&gt;</code>. The value of the symbol is used as a default
template parameter for <code>use_classes</code>, <code>method</code>, <code>virtual_ptr</code>, and others. Once
the <code>core</code> header has been included, changing <code>BOOST_OPENMETHOD_DEFAULT_POLICY</code>
has no effect. See below for examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="error_handling">Error Handling</h3>
<div class="paragraph">
<p>When an error is encountered, the program is terminated by a call to <code>abort</code>. If
the policy contains an <code>error_handler</code> facet, its <code>error</code> template member
function is called with an object identifying the error. The <code>release</code> and
<code>debug</code> policies implement the error facet with <code>vectored_error_handler</code>, which
wraps the error object in a variant, and calls a <code>std::function</code> which can be
set by the user. The function can throw an exception to prevent program
termination. The default value for the function prints a description of the
error to <code>stderr</code> in the <code>debug</code> policy, and does nothing in the <code>release.</code></p>
</div>
<div class="paragraph">
<p>Error handling can be customized by setting the function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD_CLASSES</span><span class="p">(</span><span class="n">Animal</span><span class="p">,</span> <span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD</span><span class="p">(</span><span class="n">trick</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">trick</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"spin</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">namespace</span> <span class="n">bom</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="p">;</span>
    <span class="n">bom</span><span class="o">::</span><span class="n">initialize</span><span class="p">();</span>

    <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">default_</span><span class="o">::</span><span class="n">set_error_handler</span><span class="p">([](</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">([](</span><span class="k">auto</span><span class="o">&amp;&amp;</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="n">arg</span><span class="p">;</span> <span class="p">},</span> <span class="n">error</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="n">Cat</span> <span class="n">felix</span><span class="p">;</span>
    <span class="n">Dog</span> <span class="n">hector</span><span class="p">,</span> <span class="n">snoopy</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">*&gt;</span> <span class="n">animals</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="n">hector</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">felix</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">snoopy</span><span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">animal</span> <span class="o">:</span> <span class="n">animals</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">trick</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="o">*</span><span class="n">animal</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">bom</span><span class="o">::</span><span class="n">not_implemented_error</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">boost</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">demangle</span><span class="p">(</span><span class="k">typeid</span><span class="p">(</span><span class="o">*</span><span class="n">animal</span><span class="p">).</span><span class="n">name</span><span class="p">())</span>
                      <span class="o">&lt;&lt;</span> <span class="s">"s don't perform tricks</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">spin
Cats don't perform tricks
spin</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same result can be achieved by creating a policy that uses the <code>throw_error</code>
facet implementaion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">bom</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">throwing_policy</span>
    <span class="o">:</span> <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">default_</span><span class="o">::</span><span class="n">rebind</span><span class="o">&lt;</span><span class="n">throwing_policy</span><span class="o">&gt;::</span><span class="n">replace</span><span class="o">&lt;</span>
          <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">error_handler</span><span class="p">,</span> <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">throw_error</span><span class="o">&gt;</span> <span class="p">{};</span>

<span class="n">BOOST_OPENMETHOD_CLASSES</span><span class="p">(</span><span class="n">Animal</span><span class="p">,</span> <span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">,</span> <span class="n">throwing_policy</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD</span><span class="p">(</span>
    <span class="n">trick</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="p">,</span> <span class="n">throwing_policy</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">trick</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"spin</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">bom</span><span class="o">::</span><span class="n">initialize</span><span class="o">&lt;</span><span class="n">throwing_policy</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="n">Cat</span> <span class="n">felix</span><span class="p">;</span>
    <span class="n">Dog</span> <span class="n">hector</span><span class="p">,</span> <span class="n">snoopy</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">*&gt;</span> <span class="n">animals</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="n">hector</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">felix</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">snoopy</span><span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">animal</span> <span class="o">:</span> <span class="n">animals</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">trick</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="o">*</span><span class="n">animal</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">bom</span><span class="o">::</span><span class="n">not_implemented_error</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">boost</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">demangle</span><span class="p">(</span><span class="k">typeid</span><span class="p">(</span><span class="o">*</span><span class="n">animal</span><span class="p">).</span><span class="n">name</span><span class="p">())</span>
                      <span class="o">&lt;&lt;</span> <span class="s">"s don't perform tricks</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom_rtti">Custom RTTI</h3>
<div class="paragraph">
<p>Stock policies use the <code>std_rtti</code> implementation of <code>rtti</code>. Here is its full
source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">std_rtti</span> <span class="o">:</span> <span class="n">rtti</span> <span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="n">type_id</span> <span class="n">static_type</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">type_id</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">typeid</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="n">type_id</span> <span class="nf">dynamic_type</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">type_id</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">typeid</span><span class="p">(</span><span class="n">obj</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Stream</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="kt">void</span> <span class="nf">type_name</span><span class="p">(</span><span class="n">type_id</span> <span class="n">type</span><span class="p">,</span> <span class="n">Stream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stream</span> <span class="o">&lt;&lt;</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">type_info</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">type_index</span> <span class="nf">type_index</span><span class="p">(</span><span class="n">type_id</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">type_index</span><span class="p">(</span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">type_info</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">type</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">D</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">B</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="n">D</span> <span class="nf">dynamic_cast_ref</span><span class="p">(</span><span class="n">B</span><span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>static_type</code> is used by class registration, by <code>virtual_ptr&#8217;s "final"
constructs, and to format error and trace messages. `T</code> is not restricted to
the classes that appear as virtual parameters. This function is required.</p>
</li>
<li>
<p><code>dynamic_type</code> is used to locate the v-table for an object. This function is
required, unless only the <code>virtual_ptr</code> "final" constructs are used.</p>
</li>
<li>
<p><code>type_name</code> writes a representation of <code>type</code> to <code>stream</code>. It is used to format
error and trace messages. <code>Stream</code> is a lighweight version of <code>std::ostream</code>
with reduced functionality. It only supports insertion of <code>const char*</code>,
<code>std::string_view</code>, pointers and <code>std::size_t</code>. This function is optional;
if not provided, "type_id(<em>type</em>)" is written.</p>
</li>
<li>
<p><code>type_index</code> returns an object that <em>uniquely</em> identifies a class. Some forms
of RTTI (most notably, C++'S <code>typeid</code> operator) do not guarantee that the
type information object for a class is unique within the same program. This
function is optional; if not provided, <code>type</code> is assumed to be unique, and
used as is.</p>
</li>
<li>
<p><code>dynamic_cast_ref`casts `obj</code> to class <code>D</code>. <code>B&amp;&amp;</code> is either a lvalue reference
(possibly cv-qualified) or a rvalue reference. <code>D</code> has the same reference
category (and cv-qualifier if applicable) as <code>B</code>. This function is required
only if virtual inheritance is used in the class hierarchies involved with
open-methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider a custom RTTI implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">Animal</span> <span class="p">{</span>
    <span class="n">Animal</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">type</span><span class="p">)</span> <span class="o">:</span> <span class="n">type</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">Animal</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="kt">unsigned</span> <span class="n">type</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="n">static_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="n">Animal</span> <span class="p">{</span>
    <span class="n">Cat</span><span class="p">()</span> <span class="o">:</span> <span class="n">Animal</span><span class="p">(</span><span class="n">static_type</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="n">static_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// ditto for Dog</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This scheme has an interesting property: its type ids are monotonically
allocated in a small, dense range. Thus, we don&#8217;t need to hash them. We can use
them as indexes in the table of vptrs.</p>
</div>
<div class="paragraph">
<p>This time we are going to replace the default policy globally. First we need to
define the custom RTTI facet. We must <em>not</em> include
<code>&lt;boost/openmethod/core.hpp&gt;</code> or any header that includes it yet.</p>
</div>
<div class="paragraph">
<p>Here is the facet implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;boost/openmethod/policies/core.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;boost/openmethod/policies/vptr_vector.hpp&gt;</span><span class="cp">
</span>
<span class="k">namespace</span> <span class="n">bom</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">custom_rtti</span> <span class="o">:</span> <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">rtti</span> <span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="n">bom</span><span class="o">::</span><span class="n">type_id</span> <span class="n">static_type</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of_v</span><span class="o">&lt;</span><span class="n">Animal</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">T</span><span class="o">::</span><span class="n">static_type</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="n">bom</span><span class="o">::</span><span class="n">type_id</span> <span class="nf">dynamic_type</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of_v</span><span class="o">&lt;</span><span class="n">Animal</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">.</span><span class="n">type</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This facet is quite minimal. It would not produce good error or trace messages,
so we will not keep the related facets. It does not support virtual inheritance.</p>
</div>
<div class="paragraph">
<p>This time we will create a policy from scratch. For that we use the
<code>basic_policy</code> CRTP template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">custom_policy</span>
    <span class="o">:</span> <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">basic_policy</span><span class="o">&lt;</span>
          <span class="n">custom_policy</span><span class="p">,</span> <span class="n">custom_rtti</span><span class="p">,</span>
          <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">vptr_vector</span><span class="o">&lt;</span><span class="n">custom_policy</span><span class="o">&gt;&gt;</span> <span class="p">{};</span>

<span class="cp">#define BOOST_OPENMETHOD_DEFAULT_POLICY custom_policy</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can include the other headers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;boost/openmethod.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;boost/openmethod/compiler.hpp&gt;</span><span class="cp">
</span>
<span class="n">BOOST_OPENMETHOD</span><span class="p">(</span><span class="n">poke</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">virtual_</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&amp;&gt;</span><span class="p">),</span> <span class="kt">void</span><span class="p">);</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">poke</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Cat</span><span class="o">&amp;</span> <span class="n">cat</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"hiss"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">poke</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">Dog</span><span class="o">&amp;</span> <span class="n">dog</span><span class="p">),</span> <span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"bark"</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOST_OPENMETHOD_CLASSES</span><span class="p">(</span><span class="n">Animal</span><span class="p">,</span> <span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="o">::</span><span class="n">initialize</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">(</span><span class="k">new</span> <span class="n">Cat</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">(</span><span class="k">new</span> <span class="n">Dog</span><span class="p">);</span>

    <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span> <span class="c1">// prints "hiss"</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="n">poke</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span> <span class="c1">// prints "bark"</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This programs compiles even if standard RTTI is disabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="deferred_rtti">Deferred RTTI</h3>
<div class="paragraph">
<p>The RTTI system assigns the types id statically. It is more common to allocate
them using a global counter, manipulated by static constructors. This is a
problem, because <code>static_type</code> is used by class registration. It may read the
custom type ids <em>before</em> they are have been initialized.</p>
</div>
<div class="paragraph">
<p>The solution is to add the <code>deferred_static_rtti</code> to the policy; it defers
reading the type information until <code>initialize</code> is called.</p>
</div>
<div class="paragraph">
<p>This time let&#8217;s support virtual inheritance as well. First the domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">custom_type_info</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">unsigned</span> <span class="n">last</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">id</span> <span class="o">=</span> <span class="o">++</span><span class="n">last</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">unsigned</span> <span class="n">custom_type_info</span><span class="o">::</span><span class="n">last</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">Animal</span> <span class="p">{</span>
    <span class="n">Animal</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">type_info</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">Animal</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

    <span class="k">virtual</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">cast_impl</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">type_info</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">nullptr</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Class</span><span class="p">&gt;</span>
    <span class="n">Class</span><span class="o">*</span> <span class="nf">cast</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">cast_impl</span><span class="p">(</span><span class="n">Class</span><span class="o">::</span><span class="n">type_info</span><span class="p">.</span><span class="n">id</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="n">custom_type_info</span> <span class="n">type_info</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">custom_type_info</span> <span class="n">Animal</span><span class="o">::</span><span class="n">type_info</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">Cat</span> <span class="o">:</span> <span class="k">virtual</span> <span class="n">Animal</span> <span class="p">{</span>
    <span class="n">Cat</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">type_info</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="kt">void</span><span class="o">*</span> <span class="nf">cast_impl</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">type_info</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">Animal</span><span class="o">::</span><span class="n">cast_impl</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="n">custom_type_info</span> <span class="n">type_info</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">custom_type_info</span> <span class="n">Cat</span><span class="o">::</span><span class="n">type_info</span><span class="p">;</span>

<span class="c1">// ditto for Dog</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The rtti facet is the same, with one more function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">custom_rtti</span> <span class="o">:</span> <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">rtti</span> <span class="p">{</span>
    <span class="c1">// as before</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Derived</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Base</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="n">Derived</span> <span class="n">dynamic_cast_ref</span><span class="p">(</span><span class="n">Base</span><span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">using</span> <span class="n">base_type</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of_v</span><span class="o">&lt;</span><span class="n">Animal</span><span class="p">,</span> <span class="n">base_type</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">*</span><span class="n">obj</span><span class="p">.</span><span class="k">template</span> <span class="n">cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">Derived</span><span class="p">&gt;</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">abort</span><span class="p">();</span> <span class="c1">// not supported</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the policy contains an additional facet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">custom_policy</span>
    <span class="o">:</span> <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">basic_policy</span><span class="o">&lt;</span>
          <span class="n">custom_policy</span><span class="p">,</span> <span class="n">custom_rtti</span><span class="p">,</span>
          <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">deferred_static_rtti</span><span class="p">,</span> <span class="c1">// &lt;-- additional facet</span>
          <span class="n">bom</span><span class="o">::</span><span class="n">policies</span><span class="o">::</span><span class="n">vptr_vector</span><span class="o">&lt;</span><span class="n">custom_policy</span><span class="o">&gt;&gt;</span> <span class="p">{};</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="headers">Headers</h3>

</div>
<div class="sect2">
<h3 id="namespaces">Namespaces</h3>

</div>
<div class="sect2">
<h3 id="macros">Macros</h3>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD">BOOST_OPENMETHOD</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="p">(</span><span class="n">PARAMETERS</span><span class="p">...),</span> <span class="n">RETURN_TYPE</span> <span class="p">[,</span> <span class="n">POLICY</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Macro Parameters</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>NAME</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PARAMETERS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The formal parameters of the method, consisting of a list of comma-separated
  <strong>types</strong>. At least one parameter decorated with <code>virtual_</code> or <code>virtual_ptr</code> is
  required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RETURN_TYPE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The return type of the method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>POLICY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional policy. If not specified, <code>BOOST_OPENMETHOD_DEFAULT_POLICY</code> is used.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Create an open-method.</p>
</div>
<div class="paragraph">
<p>The macro expands to several constructs, the most important of which is an
inline function called <code>NAME</code>, with a formal parameter list that consists of the
types listed in <code><em>PARAMETERS</em></code>, stripped from any <code>virtual_</code> decorator
(<code>virtual_ptr</code>s are preserved), and returning a <code>RETURN_TYPE</code>.</p>
</div>
<div class="paragraph">
<p>The function creates additional entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>struct</code> forward declaration that acts as the method&#8217;s identifier:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nf">BOOST_OPENMETHOD_NAME</span><span class="p">(</span><span class="n">NAME</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A guide function used to match overriders with the method:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">auto</span> <span class="n">BOOST_OPENMETHOD_NAME</span><span class="p">(</span><span class="n">NAME</span><span class="p">)</span><span class="n">_guide</span><span class="p">(...)</span>
    <span class="o">-&gt;</span> <span class="o">::</span><span class="n">boost</span><span class="o">::</span><span class="n">openmethod</span><span class="o">::</span><span class="n">method</span><span class="o">&lt;</span>
        <span class="n">BOOST_OPENMETHOD_NAME</span><span class="p">(</span><span class="n">NAME</span><span class="p">)(</span><span class="n">PARAMETERS</span><span class="p">...),</span> <span class="n">RETURN_TYPE</span> <span class="p">[,</span> <span class="n">POLICY</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD_OVERRIDE">BOOST_OPENMETHOD_OVERRIDE</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD_OVERRIDE</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="p">(</span><span class="n">PARAMETERS</span><span class="p">...),</span> <span class="n">RETURN_TYPE</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// body</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Macro Parameters</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>NAME</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PARAMETERS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The formal parameters of the method, consisting of a list of comma-separated
  <strong>types</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RETURN_TYPE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The return type of the method.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Add an overrider to an open-method.</p>
</div>
<div class="paragraph">
<p><code>BOOST_OPENMETHOD_OVERRIDE</code> locates an open-method that can be called using the
overrider&#8217;s parameters, and adds the overrider to the method&#8217;s list of
overriders.</p>
</div>
<div class="paragraph">
<p>The open-method is deduced from a call to a method guide function with the
overrider&#8217;s arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">using</span> <span class="n">method_type</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="n">BOOST_OPENMETHOD_NAME</span><span class="p">(</span><span class="n">NAME</span><span class="p">)</span><span class="n">_guide</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">declval</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="p">()...))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The macro creates several entities in the current scope.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A class template that acts as a container for the overriders of all methods
called <code>NAME</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="o">...</span><span class="p">&gt;</span> <span class="n">BOOST_OPENMETHOD_OVERRIDERS</span><span class="p">(</span><span class="n">NAME</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A specialization of the container template for the overrider:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">BOOST_OPENMETHOD_OVERRIDERS</span><span class="p">(</span><span class="n">NAME</span><span class="p">)</span><span class="o">&lt;</span><span class="n">RETURN_TYPE</span><span class="p">(</span><span class="n">PARAMETERS</span><span class="p">...)</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="n">fn</span><span class="p">(</span><span class="n">PARAMETERS</span><span class="p">...)</span> <span class="o">-&gt;</span> <span class="n">RETURN_TYPE</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="n">has_next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">method_type</span> <span class="o">=</span> <span class="p">...;</span>
    <span class="k">static</span> <span class="n">method_</span><span class="o">::</span><span class="n">_type</span><span class="o">::</span><span class="n">return_type</span> <span class="n">next</span><span class="p">(</span><span class="cm">/* method_parameters */</span><span class="p">);</span>
<span class="p">};</span>
<span class="k">auto</span> <span class="n">BOOST_OPENMETHOD_OVERRIDERS</span><span class="p">(</span><span class="n">NAME</span><span class="p">)</span><span class="o">&lt;</span><span class="n">RETURN_TYPE</span><span class="p">(</span><span class="n">PARAMETERS</span><span class="p">...)</span><span class="o">&gt;::</span><span class="n">fn</span><span class="p">(</span><span class="n">PARAMETERS</span><span class="p">...)</span> <span class="o">-&gt;</span> <span class="n">RETURN_TYPE</span> <span class="p">{</span>
    <span class="c1">// body</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD_INLINE_OVERRIDE">BOOST_OPENMETHOD_INLINE_OVERRIDE</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD_INLINE_OVERRIDE</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="p">(</span><span class="n">PARAMETERS</span><span class="p">...),</span> <span class="n">RETURN_TYPE</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// body</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>BOOST_OPENMETHOD_INLINE_OVERRIDE</code> performs the same function as
<code>BOOST_OPENMETHOD_OVERRIDE</code>, but the overrider is defined inline.</p>
</div>
</div>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD_REGISTER">BOOST_OPENMETHOD_REGISTER</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD_REGISTER</span><span class="p">(</span><span class="n">TYPE</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Macro Parameters</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TYPE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A type name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Create a static instance of <code>TYPE</code>, using a unique generated name.</p>
</div>
</div>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD_CLASSES">BOOST_OPENMETHOD_CLASSES</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">BOOST_OPENMETHOD_CLASSES</span><span class="p">(</span><span class="n">CLASSES</span><span class="p">...[,</span> <span class="n">POLICY</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Macro Parameters</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CLASSES</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>POLICY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional policy. If not specified, <code>BOOST_OPENMETHOD_DEFAULT_POLICY</code> is used.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Register <code>CLASSES</code> with a policy.</p>
</div>
</div>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD_DEFAULT_POLICY">BOOST_OPENMETHOD_DEFAULT_POLICY</h4>
<div class="paragraph">
<p>The name of the default policy.</p>
</div>
<div class="paragraph">
<p><code>BOOST_OPENMETHOD_DEFAULT_POLICY</code> is the default value for the <code>Policy</code> template
parameter of <code>method</code>, <code>use_classes</code>, and other constructs defined in
<code>&lt;boost/openmethod/core.hpp&gt;</code>. If it is not defined,
<code>::boost::openmethod::policy::default_</code> is used.</p>
</div>
<div class="paragraph">
<p><code>BOOST_OPENMETHOD_DEFAULT_POLICY</code> can be defined by a program to change the
default policy globally. Once <code>&lt;boost/openmethod/core.hpp&gt;</code> has been included,
redefining the symbol has no effect. The proper sequence is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Include headers under <code>boost/openmethod/policies/</code> as needed.</p>
</li>
<li>
<p>Create a policy class, and set <code>BOOST_OPENMETHOD_DEFAULT_POLICY</code>.</p>
</li>
<li>
<p>Include <code>&lt;boost/openmethod/core.hpp&gt;</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD_NAME">BOOST_OPENMETHOD_NAME</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#define BOOST_OPENMETHOD_NAME(NAME) boost_openmethod_##NAME</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Macro Parameters</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>NAME</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a method.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>BOOST_OPENMETHOD_NAME</code> is used by the macro API to generate the <code>Name</code>
parameter of a <code>method</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BOOST_OPENMETHOD_OVERRIDERS">BOOST_OPENMETHOD_OVERRIDERS</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="cp">#define BOOST_OPENMETHOD_OVERRIDERS(NAME)                                      \
    BOOST_PP_CAT(BOOST_OPENMETHOD_NAME(NAME), _overriders)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>BOOST_OPENMETHOD_OVERRIDERS</code> is used by the macro API to generate the name of
the class template that contains the overriders for the method named <code>NAME</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="core_api_2">Core API</h3>
<div class="sect3">
<h4 id="method">method</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">boost</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="n">openmethod</span> <span class="p">{</span>

<span class="k">template</span><span class="o">&lt;</span>
    <span class="k">typename</span> <span class="nc">Method</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">ReturnType</span><span class="p">,</span>
    <span class="k">class</span> <span class="nc">Policy</span> <span class="o">=</span> <span class="n">BOOST_OPENMETHOD_DEFAULT_POLICY</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">method</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Name</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">ReturnType</span><span class="p">,</span> <span class="k">typename</span><span class="o">...</span> <span class="nc">Parameters</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Policy</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">method</span><span class="o">&lt;</span><span class="n">Name</span><span class="p">(</span><span class="n">Parameters</span><span class="p">...),</span> <span class="n">ReturnType</span><span class="p">,</span> <span class="n">Policy</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nl">public:</span>
    <span class="k">using</span> <span class="n">name_type</span> <span class="o">=</span> <span class="n">Name</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">return_type</span> <span class="o">=</span> <span class="n">ReturnType</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">function_type</span> <span class="o">=</span> <span class="n">ReturnType</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">detail</span><span class="o">::</span><span class="n">remove_virtual</span><span class="o">&lt;</span><span class="n">Parameters</span><span class="o">&gt;</span><span class="p">...);</span>

    <span class="n">method</span><span class="p">();</span>
    <span class="n">method</span><span class="p">(</span><span class="k">const</span> <span class="n">method</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="n">method</span><span class="p">(</span><span class="n">method</span><span class="o">&amp;&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
    <span class="o">~</span><span class="n">method</span><span class="p">();</span>

    <span class="k">auto</span> <span class="k">operator</span><span class="p">()(</span><span class="n">detail</span><span class="o">::</span><span class="n">remove_virtual</span><span class="o">&lt;</span><span class="n">Parameters</span><span class="o">&gt;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="k">const</span> <span class="o">-&gt;</span> <span class="n">ReturnType</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">method</span> <span class="n">fn</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">auto</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="n">function_type</span> <span class="n">next</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">auto</span><span class="p">...</span> <span class="n">Function</span><span class="p">&gt;</span>
    <span class="k">struct</span> <span class="nc">override</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>basic_error_output</code> implements the <code>error_output</code> facet.</p>
</div>
<div class="paragraph">
<p><strong>Template Parameters</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Policy</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The policy containing the facet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Stream</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that satisfies the requirements of <code>RestrictedOutputStream</code>.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="error_stream">error_stream</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">Stream</span>  <span class="n">error_stream</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Initialized by the default constructor of <code>Stream</code>. It is the responsibility of
the program to initializate it if needed, e.g., for a <code>std::ofstream</code>, to open
it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="virtual">virtual_</h4>

</div>
<div class="sect3">
<h4 id="virtual_ptr_2">virtual_ptr</h4>

</div>
</div>
<div class="sect2">
<h3 id="policies_facets">Policies &amp; Facets</h3>
<div class="sect3">
<h4 id="basic_policy">basic_policy</h4>

</div>
<div class="sect3">
<h4 id="error_output">error_output</h4>

</div>
<div class="sect3">
<h4 id="basic_error_output">basic_error_output</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">boost</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="n">openmethod</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="n">policies</span> <span class="p">{</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Policy</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Stream</span> <span class="o">=</span> <span class="n">_unspecified_</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">basic_error_output</span> <span class="o">:</span> <span class="k">virtual</span> <span class="n">error_output</span> <span class="p">{</span>
    <span class="k">static</span> <span class="n">Stream</span> <span class="n">error_stream</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>basic_error_output</code> implements the <code>error_output</code> facet.</p>
</div>
<div class="paragraph">
<p><strong>Template Parameters</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Policy</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The policy containing the facet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Stream</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that satisfies the requirements of <code>RestrictedOutputStream</code>.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="error_stream_2">error_stream</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">Stream</span>  <span class="n">error_stream</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Initialized by the default constructor of <code>Stream</code>. It is the responsibility of
the program to initializate it if needed, e.g., for a <code>std::ofstream</code>, to open
it.
<mark>#</mark> rtti</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">struct</span> <span class="nc">rtti</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">deferred_static_rtti</span> <span class="o">:</span> <span class="k">virtual</span> <span class="n">rtti</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>rtti</code> facet provides type information for classes and objects, implements
downcast in presence of virtual inheritance, and writes descriptions of types to
an <code>ostream</code>-like object.</p>
</div>
<div class="paragraph">
<p><code>rtti</code> implementations are required to provide the following functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>type_id static_type&lt;Class&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>return a <code>type_id</code> for <code>Class</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>yes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>type_id dynamic_type&lt;Class&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>return a <code>type_id</code> for an object&#8217;s dynamic type</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>if virtual inheritance is used</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>void type_name&lt;Stream&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>write a description of <code>type_id</code> to a stream</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>no</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>unspecified</em> type_index</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>return a unique key for a <code>type_id</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>depending on context</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Derived dynamic_cast_ref&lt;Derived, Base&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>cast from base class to derived class</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>if using virtual inheritance</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Note:</dt>
<dd>
<p><code>Stream</code> is not guaranteed to be a <code>std::ostream</code>. The only guaranteed
operations are the insertion of <code>const char*</code>, <code>std::string_view</code>, <code>const
void*</code>, <code>std::size_t</code> and <code>type_id</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="std_rtti">std_rtti</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">namespace</span> <span class="n">boost</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="n">openmethod</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="n">policies</span> <span class="p">{</span>

<span class="k">struct</span> <span class="nc">std_rtti</span> <span class="o">:</span> <span class="k">virtual</span> <span class="n">rtti</span> <span class="p">{</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Class</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="n">static_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">type_id</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Class</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="n">dynamic_type</span><span class="p">(</span><span class="k">const</span> <span class="n">Class</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">type_id</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Stream</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="n">type_name</span><span class="p">(</span><span class="n">type_id</span> <span class="n">type</span><span class="p">,</span> <span class="n">Stream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">void</span><span class="p">;</span>

    <span class="k">static</span> <span class="k">auto</span> <span class="n">type_index</span><span class="p">(</span><span class="n">type_id</span> <span class="n">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">type_index</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">D</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">B</span><span class="p">&gt;</span>
    <span class="k">static</span> <span class="k">auto</span> <span class="n">dynamic_cast_ref</span><span class="p">(</span><span class="n">B</span><span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">D</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}}}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="static_type">static_type</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Class</span><span class="p">&gt;</span>
<span class="k">static</span> <span class="n">type_id</span> <span class="nf">static_type</span><span class="p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the address of <code>Class&#8217;s `type_info</code>, cast to a <code>type_id</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="dynamic_type">dynamic_type</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Class</span><span class="p">&gt;</span>
<span class="k">static</span> <span class="n">type_id</span> <span class="nf">dynamic_type</span><span class="p">(</span><span class="k">const</span> <span class="n">Class</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the address of <code>obj</code>'s <code>type_info</code>, cast to a <code>type_id</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type_name">type_name</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Stream</span><span class="p">&gt;</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">type_name</span><span class="p">(</span><span class="n">type_id</span> <span class="n">type</span><span class="p">,</span> <span class="n">Stream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Write the demangled name of the class identified by <code>type</code> to <code>stream</code>.
Execute <code>stream &lt;&lt; reinterpret_cast&lt;const std::type_info*&gt;(type)&#8594;name()</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type_index">type_index</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">static</span> <span class="cm">/*unspecified*/</span> <span class="n">type_index</span><span class="p">(</span><span class="n">type_id</span> <span class="n">type</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Return <code>std::type_index(<strong>reinterpret_cast&lt;const std::type_info</strong>&gt;(type))</code>.</p>
</div>
<div class="paragraph">
<p>The function is required because C++ does <strong>not</strong> guarantee that there is a single
instance of <code>std::type_info</code> for each specific type.</p>
</div>
</div>
<div class="sect4">
<h5 id="dynamic_cast_ref">dynamic_cast_ref</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Derived</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Base</span><span class="p">&gt;</span>
<span class="k">static</span> <span class="n">Derived</span> <span class="nf">dynamic_cast_ref</span><span class="p">(</span><span class="n">Base</span><span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cast <code>obj</code> using the <code>dynamic_cast</code> operator.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deferred_static_rtti">deferred_static_rtti</h4>
<div class="paragraph">
<p><code>deferred_static_rtti</code>, directs OpenMethod to defer collection of static type
information until <code>initialize</code> is called. This makes it possible to interface
with custom RTTI systems that use static constructors to assign type
information.</p>
</div>
<div class="paragraph">
<p>This facet is its own implementation.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-10-14 11:04:59 -0400
</div>
</div>
</body>
</html>